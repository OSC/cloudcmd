<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="robots" content="noindex,nofollow">
    <meta name="theme-color" content="rgb(49,123,249)">
    <!-- mobile first design -->
    <meta content="width=device-width,initial-scale=1" name="viewport">
    <link rel="icon" href="{{ prefix }}/favicon.ico">
    <title>{{ title }}</title>

    <link rel=stylesheet href="{{ prefix }}/css/urls.css">
    <!-- OSC_CUSTOM_CODE add custom bootstrap stylesheet path -->
    <link rel=stylesheet href="{{ prefix }}/css/ood_bootstrap.css">
    <link rel=stylesheet href="{{ prefix }}/join:{{ css }}">
    <noscript>
        <link rel=stylesheet href="{{ prefix }}/css/nojs.css">
    </noscript>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
    <script>
        var jQuery12 = $.noConflict(true);
        // replace this with shim: https://github.com/mathiasbynens/String.prototype.startsWith
        // http://stackoverflow.com/questions/646628/how-to-check-if-a-string-startswith-another-string
        if(typeof String.prototype.startsWith === "undefined"){
            String.prototype.startsWith = function(str){
                return this.indexOf(str, 0) === 0;
            }
        }
    </script>
</head>
<body>
<div class="bootstrap panel-btns">
    <button type="button" class="bootstrap icon icon-console btn btn-default btn-sm" onclick="terminal()">Open in Terminal</button>
    <button type="button" class="bootstrap icon icon-paste btn btn-default btn-sm" onclick="DOM.Buffer.paste()">Paste</button>
    <button type="button" class="bootstrap icon icon-file btn btn-default btn-sm" onclick="DOM.promptNewFile()">New File</button>
    <button type="button" class="bootstrap icon icon-directory btn btn-default btn-sm" onclick="DOM.promptNewDir()">New Dir</button>
    <button type="button" class="bootstrap icon icon-upload btn btn-default btn-sm" onclick="CloudCmd.Upload.show();">Upload</button>
    <label class="bootstrap checkbox-inline"><input type="checkbox" class="bootstrap" id="checkbox-dotfiles" onclick="dotfilesChecked()" value="">Show Dotfiles</label>
</div>
<div class=fm>{{ fm }}</div>
<div id="js-keyspanel" class="keyspanel">
    <!-- OSC_CUSTOM_CODE remove this button >> <button id=f1      class="cmd-button reduce-text icon-help"      title="Help"            >F1</button> -->
    <button id=f2      class="cmd-button reduce-text icon-rename"    title="Rename"          >F2</button>
    <button id=f3      class="cmd-button reduce-text icon-view"      title="View"            >F3</button>
    <button id=f4      class="cmd-button reduce-text icon-edit "     title="Edit"            >F4</button>
    <button id=f5      class="cmd-button reduce-text icon-copy"      title="Copy"            >F5</button>
    <button id=f6      class="cmd-button reduce-text icon-move"      title="Move"            >F6</button>
    <button id=f7      class="cmd-button reduce-text icon-directory" title="New Directory"   >F7</button>
    <button id=f8      class="cmd-button reduce-text icon-delete"    title="Delete"          >F8</button>
    <button id=f9      class="cmd-button reduce-text icon-menu"      title="Menu"            >F9</button>
    <button id=f10     class="cmd-button reduce-text icon-config"    title="Config"          >F10</button>
    <!-- OSC_CUSTOM_CODE Convert console button to a link to wetty and remove the original defaults -->
    <a onclick='window.open(CloudFunc.getWettyLink(CloudFunc.Path))' target="_blank"><button id=wetty       class="cmd-button reduce-text icon-console"   title="Wetty">~</button></a>
    <!-- OSC_CUSTOM_CODE remove this button >> <button id=contact class="cmd-button reduce-text icon-contact"   title="Contact"         ></button> -->
</div>
<script src="{{ prefix }}/cloudcmd.js"></script>
<script>
    CloudCmd('{{ prefix }}');

    function terminal() {
        var terminal_path = '/pun/sys/shell/ssh/oakley';
        window.open(terminal_path + DOM.getCurrentDirPath());
    }

    function dotfiles() {
        if (document.getElementById("checkbox-dotfiles").checked) {
            $( ".files li.dotfile" ).css('display', '');
        } else {
            $( ".files li.dotfile" ).css('display', 'none');
        }
    }

    window.onload = function() {
        document.getElementById("checkbox-dotfiles").checked = ( getCookie('dotfiles') === 'true' );
        dotfiles();
    };

    // Sets the cookie when the dotfiles box is checked
    function dotfilesChecked() {
        if (document.getElementById("checkbox-dotfiles").checked) {
            setCookie('dotfiles', true, 9999);
        } else {
            setCookie('dotfiles', false, 9999);
        }
        dotfiles();
    }

    function setCookie(cname, cvalue, exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires="+d.toUTCString();
        document.cookie = cname + "=" + cvalue + "; " + expires;
    }

    function getCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for(var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }

    // OSC_CUSTOM_CODE publicize download method from lib/client/menu.js
    function download() {
        var TIME        = 30 * 1000,
                prefixUr    = CloudCmd.PREFIX_URL,
                FS          = CloudFunc.FS,
                PACK        = '/pack',
                date        = Date.now(),
                files       = DOM.getActiveFiles();

        if (!files.length)
            DOM.Dialog.alert.noFiles();
        else
            files.forEach(function(file) {
                var element,
                        selected    = DOM.isSelected(file),
                        path        = DOM.getCurrentPath(file),
                        id          = DOM.load.getIdBySrc(path),
                        isDir       = DOM.isCurrentIsDir(file);

                CloudCmd.log('downloading file ' + path + '...');

                if (isDir)
                    path        = prefixUr + PACK + path + '.tar.gz';
                else
                    path        = prefixUr + FS + path + '?download';

                element     = DOM.load({
                    id          : id + '-' + date,
                    name        : 'iframe',
                    async       : false,
                    className   : 'hidden',
                    src         : path
                });

                setTimeout(function() {
                    document.body.removeChild(element);
                }, TIME);

                if (selected)
                    DOM.toggleSelectedFile(file);
            });
    }
</script>
</body>
</html>
